"use strict";require("source-map-support/register");
require("bluebird-global");
require("./env");

var _logger = _interopRequireDefault(require("./logger"));


var _server = _interopRequireDefault(require("./server"));function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}

const { logger } = _logger.default;


function exitHandler(options) {
  if (_server.default) {
    logger.warn('Exiting...');
    _server.default.close(() => {
      if (options.exit) {
        process.exit(0);
      }
    });

    setTimeout((e) => {
      logger.error('Forcing server close !!!', e);
      process.kill(process.pid, 'SIGUSR2');
    }, 1000);
  }
}


process.once('SIGINT', exitHandler.bind(null, { exit: true }));
process.once('SIGUSR1', exitHandler.bind(null, { exit: true }));
process.once('SIGUSR2', exitHandler.bind(null, { exit: true }));
process.once('SIGTERM', exitHandler.bind(null, { exit: true }));
process.once('SIGHUP', exitHandler.bind(null, { exit: true }));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC50cyJdLCJuYW1lcyI6WyJsb2dnZXIiLCJMb2ciLCJleGl0SGFuZGxlciIsIm9wdGlvbnMiLCJzZXJ2ZXIiLCJ3YXJuIiwiY2xvc2UiLCJleGl0IiwicHJvY2VzcyIsInNldFRpbWVvdXQiLCJlIiwiZXJyb3IiLCJraWxsIiwicGlkIiwib25jZSIsImJpbmQiXSwibWFwcGluZ3MiOiI7QUFDQTtBQUNBOztBQUVBOzs7QUFHQSwwRDs7QUFFQSxNQUFNLEVBQUNBLE1BQUQsS0FBV0MsZUFBakI7OztBQUdBLFNBQVNDLFdBQVQsQ0FBcUJDLE9BQXJCLEVBQWdEO0FBQzlDLE1BQUlDLGVBQUosRUFBWTtBQUNWSixJQUFBQSxNQUFNLENBQUNLLElBQVAsQ0FBWSxZQUFaO0FBQ0FELG9CQUFPRSxLQUFQLENBQWEsTUFBTTtBQUNqQixVQUFJSCxPQUFPLENBQUNJLElBQVosRUFBa0I7QUFDaEJDLFFBQUFBLE9BQU8sQ0FBQ0QsSUFBUixDQUFhLENBQWI7QUFDRDtBQUNGLEtBSkQ7O0FBTUFFLElBQUFBLFVBQVUsQ0FBQyxDQUFDQyxDQUFELEtBQU87QUFDaEJWLE1BQUFBLE1BQU0sQ0FBQ1csS0FBUCxDQUFhLDBCQUFiLEVBQXlDRCxDQUF6QztBQUNBRixNQUFBQSxPQUFPLENBQUNJLElBQVIsQ0FBYUosT0FBTyxDQUFDSyxHQUFyQixFQUEwQixTQUExQjtBQUNELEtBSFMsRUFHUCxJQUhPLENBQVY7QUFJRDtBQUNGOzs7QUFHREwsT0FBTyxDQUFDTSxJQUFSLENBQWEsUUFBYixFQUF1QlosV0FBVyxDQUFDYSxJQUFaLENBQWlCLElBQWpCLEVBQXVCLEVBQUNSLElBQUksRUFBRSxJQUFQLEVBQXZCLENBQXZCO0FBQ0FDLE9BQU8sQ0FBQ00sSUFBUixDQUFhLFNBQWIsRUFBd0JaLFdBQVcsQ0FBQ2EsSUFBWixDQUFpQixJQUFqQixFQUF1QixFQUFDUixJQUFJLEVBQUUsSUFBUCxFQUF2QixDQUF4QjtBQUNBQyxPQUFPLENBQUNNLElBQVIsQ0FBYSxTQUFiLEVBQXdCWixXQUFXLENBQUNhLElBQVosQ0FBaUIsSUFBakIsRUFBdUIsRUFBQ1IsSUFBSSxFQUFFLElBQVAsRUFBdkIsQ0FBeEI7QUFDQUMsT0FBTyxDQUFDTSxJQUFSLENBQWEsU0FBYixFQUF3QlosV0FBVyxDQUFDYSxJQUFaLENBQWlCLElBQWpCLEVBQXVCLEVBQUNSLElBQUksRUFBRSxJQUFQLEVBQXZCLENBQXhCO0FBQ0FDLE9BQU8sQ0FBQ00sSUFBUixDQUFhLFFBQWIsRUFBdUJaLFdBQVcsQ0FBQ2EsSUFBWixDQUFpQixJQUFqQixFQUF1QixFQUFDUixJQUFJLEVBQUUsSUFBUCxFQUF2QixDQUF2QiIsInNvdXJjZXNDb250ZW50IjpbIi8vIENvZXJjZSBnbG9iYWwgUHJvbWlzZSB0byBiZSBibHVlYmlyZFxuaW1wb3J0ICdibHVlYmlyZC1nbG9iYWwnO1xuaW1wb3J0ICcuL2Vudic7XG5cbmltcG9ydCBMb2cgZnJvbSAnQC9sb2dnZXInO1xuXG4vLyBTdGFydCB0aGUgc2VydmVyXG5pbXBvcnQgc2VydmVyIGZyb20gJy4vc2VydmVyJztcblxuY29uc3Qge2xvZ2dlcn0gPSBMb2c7XG5cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjb25zaXN0ZW50LXJldHVyblxuZnVuY3Rpb24gZXhpdEhhbmRsZXIob3B0aW9uczoge2V4aXQ/OiBib29sZWFufSkge1xuICBpZiAoc2VydmVyKSB7XG4gICAgbG9nZ2VyLndhcm4oJ0V4aXRpbmcuLi4nKTtcbiAgICBzZXJ2ZXIuY2xvc2UoKCkgPT4ge1xuICAgICAgaWYgKG9wdGlvbnMuZXhpdCkge1xuICAgICAgICBwcm9jZXNzLmV4aXQoMCk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgLy8gRm9yY2UgY2xvc2Ugc2VydmVyIGFmdGVyIDVzZWNzXG4gICAgc2V0VGltZW91dCgoZSkgPT4ge1xuICAgICAgbG9nZ2VyLmVycm9yKCdGb3JjaW5nIHNlcnZlciBjbG9zZSAhISEnLCBlKTtcbiAgICAgIHByb2Nlc3Mua2lsbChwcm9jZXNzLnBpZCwgJ1NJR1VTUjInKTtcbiAgICB9LCAxMDAwKTtcbiAgfVxufVxuXG4vLyBIYW5kbGUgYWxsIGV4aXQgY29kZXMgaW1hZ2luYWJsZVxucHJvY2Vzcy5vbmNlKCdTSUdJTlQnLCBleGl0SGFuZGxlci5iaW5kKG51bGwsIHtleGl0OiB0cnVlfSkpO1xucHJvY2Vzcy5vbmNlKCdTSUdVU1IxJywgZXhpdEhhbmRsZXIuYmluZChudWxsLCB7ZXhpdDogdHJ1ZX0pKTtcbnByb2Nlc3Mub25jZSgnU0lHVVNSMicsIGV4aXRIYW5kbGVyLmJpbmQobnVsbCwge2V4aXQ6IHRydWV9KSk7XG5wcm9jZXNzLm9uY2UoJ1NJR1RFUk0nLCBleGl0SGFuZGxlci5iaW5kKG51bGwsIHtleGl0OiB0cnVlfSkpO1xucHJvY2Vzcy5vbmNlKCdTSUdIVVAnLCBleGl0SGFuZGxlci5iaW5kKG51bGwsIHtleGl0OiB0cnVlfSkpO1xuIl19